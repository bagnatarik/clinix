<app-data-table-component
  newButtonLabel="Ajouter une entrée"
  tableName="Planning"
  [columns]="columns"
  [data]="planning"
  [searchable]="true"
  [paginated]="true"
  [itemsPerPage]="10"
  (onNew)="handleNew()"
  (onRefresh)="handleRefresh()"
  (onEdit)="handleEdit($event)"
  (onDelete)="handleDelete($event)"
  (onRowClick)="handleRowClick($event)"
>
</app-data-table-component>

@if (showCreateModal) {
<div
  class="fixed inset-0 bg-black/10 flex items-center justify-center z-50"
  (click)="showCreateModal = false"
>
  <div class="bg-white rounded p-5 w-96 shadow-md" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-medium text-gray-800">Ajouter une entrée au planning</h2>
      <button
        (click)="showCreateModal = false"
        class="text-gray-400 hover:text-gray-600 hover:cursor-pointer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="size-4"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="grid grid-cols-1 gap-3">
      <div class="space-y-3">
        <div>
          <label class="block text-xs font-medium text-gray-500 mb-1">Description</label>
          <textarea
            [(ngModel)]="planningForm.description"
            placeholder="Décrire le planning..."
            rows="3"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-sm focus:outline-none"
          ></textarea>
        </div>

        <div class="relative">
          <label class="block text-xs font-medium text-gray-500 mb-1">Garde</label>
          <button
            type="button"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-gray-800 text-left text-sm flex items-center justify-between hover:bg-neutral-50"
            (click)="toggleGardeDropdown()"
            [attr.aria-expanded]="gardeDropdownOpen"
          >
            <span>{{ planningForm.garde || 'Sélectionner une garde' }}</span>
            <svg
              class="size-4 text-neutral-500"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 9l6 6 6-6" />
            </svg>
          </button>

          @if (gardeDropdownOpen) {
          <div
            class="absolute left-0 top-full mt-2 w-full bg-white border border-neutral-300 rounded shadow-sm p-2 z-50"
            (click)="$event.stopPropagation()"
            (mousedown)="$event.stopPropagation()"
          >
            <input
              type="text"
              [(ngModel)]="gardeSearch"
              [ngModelOptions]="{ standalone: true }"
              placeholder="Rechercher une garde..."
              class="w-full border border-neutral-300 rounded px-3 py-2 text-sm mb-2 focus:outline-none"
              (click)="$event.stopPropagation()"
              (mousedown)="$event.stopPropagation()"
              (keydown.enter)="$event.preventDefault()"
            />

            <div class="max-h-44 overflow-y-auto">
              <button
                type="button"
                class="w-full text-left px-3 py-2 text-sm hover:bg-blue-50 rounded"
                *ngFor="let g of filteredGardes"
                [class.bg-blue-50]="planningForm.garde === g"
                (click)="selectGarde(g)"
              >
                {{ g }}
              </button>

              <div *ngIf="filteredGardes.length === 0" class="px-3 py-2 text-xs text-neutral-500">
                Aucune garde trouvée
              </div>
            </div>
          </div>
          }
        </div>

        <div class="relative">
          <label class="block text-xs font-medium text-gray-500 mb-1">Personnel</label>
          <button
            type="button"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-gray-800 text-left text-sm flex items-center justify-between hover:bg-neutral-50"
            (click)="togglePersonnelDropdown()"
            [attr.aria-expanded]="personnelDropdownOpen"
          >
            <span>{{ planningForm.personnel || 'Sélectionner un personnel' }}</span>
            <svg
              class="size-4 text-neutral-500"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 9l6 6 6-6" />
            </svg>
          </button>

          @if (personnelDropdownOpen) {
          <div
            class="absolute left-0 top-full mt-2 w-full bg-white border border-neutral-300 rounded shadow-sm p-2 z-50"
            (click)="$event.stopPropagation()"
            (mousedown)="$event.stopPropagation()"
          >
            <input
              type="text"
              [(ngModel)]="personnelSearch"
              [ngModelOptions]="{ standalone: true }"
              placeholder="Rechercher un personnel..."
              class="w-full border border-neutral-300 rounded px-3 py-2 text-sm mb-2 focus:outline-none"
              (click)="$event.stopPropagation()"
              (mousedown)="$event.stopPropagation()"
              (keydown.enter)="$event.preventDefault()"
            />

            <div class="max-h-44 overflow-y-auto">
              <button
                type="button"
                class="w-full text-left px-3 py-2 text-sm hover:bg-blue-50 rounded"
                *ngFor="let p of filteredPersonnels"
                [class.bg-blue-50]="planningForm.personnel === p"
                (click)="selectPersonnel(p)"
              >
                {{ p }}
              </button>

              <div
                *ngIf="filteredPersonnels.length === 0"
                class="px-3 py-2 text-xs text-neutral-500"
              >
                Aucun personnel trouvé
              </div>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
    <div class="flex justify-end space-x-2 mt-5">
      <button
        (click)="showCreateModal = false"
        class="px-3 py-1.5 text-xs font-medium text-gray-600 border border-gray-200 rounded hover:bg-gray-50"
      >
        Annuler
      </button>
      <button
        (click)="createPlanningItem()"
        class="px-3 py-1.5 text-xs font-medium text-white bg-blue-500 rounded hover:bg-blue-600"
      >
        Créer
      </button>
    </div>
  </div>
</div>
} @if (showEditModal) {
<div
  class="fixed inset-0 bg-black/10 flex items-center justify-center z-50"
  (click)="showEditModal = false"
>
  <div class="bg-white rounded p-5 w-96 shadow-md" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-medium text-gray-800">Modifier l’entrée du planning</h2>
      <button
        (click)="showEditModal = false"
        class="text-gray-400 hover:text-gray-600 hover:cursor-pointer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="size-4"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="grid grid-cols-1 gap-3">
      <div class="space-y-3">
        <div>
          <label class="block text-xs font-medium text-gray-500 mb-1">Description</label>
          <textarea
            [(ngModel)]="planningForm.description"
            placeholder="Décrire le planning..."
            rows="3"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-sm focus:outline-none"
          ></textarea>
        </div>

        <div class="relative">
          <label class="block text-xs font-medium text-gray-500 mb-1">Garde</label>
          <button
            type="button"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-gray-800 text-left text-sm flex items-center justify-between hover:bg-neutral-50"
            (click)="toggleGardeDropdown()"
            [attr.aria-expanded]="gardeDropdownOpen"
          >
            <span>{{ planningForm.garde || 'Sélectionner une garde' }}</span>
            <svg
              class="size-4 text-neutral-500"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 9l6 6 6-6" />
            </svg>
          </button>

          @if (gardeDropdownOpen) {
          <div
            class="absolute left-0 top-full mt-2 w-full bg-white border border-neutral-300 rounded shadow-sm p-2 z-50"
            (click)="$event.stopPropagation()"
            (mousedown)="$event.stopPropagation()"
          >
            <input
              type="text"
              [(ngModel)]="gardeSearch"
              [ngModelOptions]="{ standalone: true }"
              placeholder="Rechercher une garde..."
              class="w-full border border-neutral-300 rounded px-3 py-2 text-sm mb-2 focus:outline-none"
              (click)="$event.stopPropagation()"
              (mousedown)="$event.stopPropagation()"
              (keydown.enter)="$event.preventDefault()"
            />

            <div class="max-h-44 overflow-y-auto">
              <button
                type="button"
                class="w-full text-left px-3 py-2 text-sm hover:bg-blue-50 rounded"
                *ngFor="let g of filteredGardes"
                [class.bg-blue-50]="planningForm.garde === g"
                (click)="selectGarde(g)"
              >
                {{ g }}
              </button>

              <div *ngIf="filteredGardes.length === 0" class="px-3 py-2 text-xs text-neutral-500">
                Aucune garde trouvée
              </div>
            </div>
          </div>
          }
        </div>

        <div class="relative">
          <label class="block text-xs font-medium text-gray-500 mb-1">Personnel</label>
          <button
            type="button"
            class="w-full border border-neutral-300 rounded px-3 py-2 text-gray-800 text-left text-sm flex items-center justify-between hover:bg-neutral-50"
            (click)="togglePersonnelDropdown()"
            [attr.aria-expanded]="personnelDropdownOpen"
          >
            <span>{{ planningForm.personnel || 'Sélectionner un personnel' }}</span>
            <svg
              class="size-4 text-neutral-500"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 9l6 6 6-6" />
            </svg>
          </button>

          @if (personnelDropdownOpen) {
          <div
            class="absolute left-0 top-full mt-2 w-full bg-white border border-neutral-300 rounded shadow-sm p-2 z-50"
            (click)="$event.stopPropagation()"
            (mousedown)="$event.stopPropagation()"
          >
            <input
              type="text"
              [(ngModel)]="personnelSearch"
              [ngModelOptions]="{ standalone: true }"
              placeholder="Rechercher un personnel..."
              class="w-full border border-neutral-300 rounded px-3 py-2 text-sm mb-2 focus:outline-none"
              (click)="$event.stopPropagation()"
              (mousedown)="$event.stopPropagation()"
              (keydown.enter)="$event.preventDefault()"
            />

            <div class="max-h-44 overflow-y-auto">
              <button
                type="button"
                class="w-full text-left px-3 py-2 text-sm hover:bg-blue-50 rounded"
                *ngFor="let p of filteredPersonnels"
                [class.bg-blue-50]="planningForm.personnel === p"
                (click)="selectPersonnel(p)"
              >
                {{ p }}
              </button>

              <div
                *ngIf="filteredPersonnels.length === 0"
                class="px-3 py-2 text-xs text-neutral-500"
              >
                Aucun personnel trouvé
              </div>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
    <div class="flex justify-end space-x-2 mt-5">
      <button
        (click)="showEditModal = false"
        class="px-3 py-1.5 text-xs font-medium text-gray-600 border border-gray-200 rounded hover:bg-gray-50"
      >
        Annuler
      </button>
      <button
        (click)="updatePlanningItem()"
        class="px-3 py-1.5 text-xs font-medium text-white bg-blue-500 rounded hover:bg-blue-600"
      >
        Enregistrer
      </button>
    </div>
  </div>
</div>
} @if (showDeleteModal) {
<div
  class="fixed inset-0 bg-black/10 flex items-center justify-center z-50"
  (click)="showDeleteModal = false"
>
  <div class="bg-white rounded p-5 w-96 shadow-md" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-lg font-medium text-gray-800">Supprimer l’entrée du planning</h2>
      <button
        (click)="showDeleteModal = false"
        class="text-gray-400 hover:text-gray-600 hover:cursor-pointer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="size-4"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <p class="text-sm text-gray-500 mb-4">Confirmez la suppression de l’entrée.</p>
    <div class="flex justify-end space-x-2">
      <button
        (click)="showDeleteModal = false"
        class="px-3 py-1.5 text-xs font-medium text-gray-600 border border-gray-200 rounded hover:bg-gray-50"
      >
        Annuler
      </button>
      <button
        (click)="deletePlanningItem()"
        class="px-3 py-1.5 text-xs font-medium text-white bg-red-500 rounded hover:bg-red-600"
      >
        Supprimer
      </button>
    </div>
  </div>
</div>
}
